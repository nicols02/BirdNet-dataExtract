# BirdNet-dataExtract
A repository for the code to extract and format migratory bird data from eBird

OVERVIEW OF METHODS USED TO EXTRACT DATA FOR NETWORK MODELLING

This document describes the methods and assumptions used to extract data from eBird for migratory network modelling.

My output files are stored in:
./Dropbox/Migratory birds network reconstruction/Data files
Code to extract the data is stored in:
./Dropbox/Migratory birds network reconstruction/R code/

# Key files
-----------------------------------
Data files:

eastern_curlew_all_eBird.Rds (large file; generated by getData.R)

EAA_ID_sites.csv

far eastern curlew_IBAs.csv

R scripts:

getData.R

plotIBAs.R

format_weekly_data.R


# Approach 
-----------------------------------
The approach is based largely on the migratory networks in Tak's paper (add ref). The aim is to reproduce the observed data for these networks 
from eBird. This requires us to associate location data to the qualitative regions used by experts in Tak's analysis, so there are a lot of decisions
that need to be made.


Firstly, data was extracted from eBird using the 'auk' package. I have only extracted a single species (FE curlew). In principle you can do all species in a loop,
but the script takes so long to run that I just started with one species.
To begin, I downloaded the whole eBird basic dataset and filtered it to get the eastern curlew data, following the instructions here: https://cran.r-project.org/web/packages/auk/vignettes/auk.html. 
Because this filtering process takes ages, it's all done in a separate script, called getData.R. 
During this process I filter by species, but also by country. We do this extra filter to reduce the size of the zero-filled dataset, otherwise the
 script just returns all global bird records. I then filter the data further by removing any data from the contiguous USA (i.e. all except Alaska), 
 and by removing all data from western Russia (anything west of the 80th parallel). 
 The output of the script is called "eastern_curlew_all_eBird.Rds" location, date and count data for the species (need to check these filenames are
 correct, has been a while!)
This extraction step is slow-- there are likely to be many ways to improve it.
The full list of columns maintained in the output Rds is (check auk for definitions of column names):
c("checklist_id", "country", "country_code", "iba_code","state", "state_code","locality_id","locality_type",
                           "latitude", "longitude", "observation_date", "sampling_event_identifier",
                           "duration_minutes", "effort_distance_km", "effort_area_ha", "number_observers", "scientific_name",
                           "observation_count", "species_observed")

The 'plotIBAs.R' script is used to manually create regional nodes that roughly match Tak's flyway network models. 
The script uses a csv of the locations of all the IBAs in the EAAF to aid us to define regions. 
All IBA information that I used is  (manually!) extracted from "Bamford, Watkins, Bancroft, Tischler, Wahl (2008) Migratory Shorebirds of the East
Asian-Australasian Flyway: Population estimates and internationally important sites. Wetlands International-- Oceania. Canberra Australia"
There is likely to be a more up-to-date (and hopefully more accessible) version of this somewhere so we should update this if we can.
My list of IBAs is stored in 'EAA_ID_sites.csv'.
The list of IBAs (with locations) is clipped to the species of interest by merging with a list of IBAs relevant to the species: 'far eastern curlew_IBAs.csv'
Once we can see the locations of the IBAs, we need to manually select the boundaries of the regions in Tak's migratory networks.
This is currently done in an ad-hoc way, where I drew regions as polygons on the map based on the rough location of the region and trying to capture
all of the IBAs for the species within my regions (ensuring that most of the population is represented by the model). This step could be improved
so it's worth brainstorming alternative/more robust ways to do this.
This step is also an opportunity to review Tak's network models for each species. We can ask other questions such as:
	1) should we add some new nodes to better represent the eBird count data? 
	2) are there alternative hypotheses that we want to investigate that wouldn't be captured by the current networks? (e.g. do we want to know if some curlews
	use a different flight path, such as staging in Taiwan or passing over the Phillipines?)
	
The 'format_weekly_data.R' script is used to assign the count data to the regional nodes defined in 'plotIBAs.R'. The script re-maps the IBAs and clips the
eBird dataset to assign count data to locations and regions.
In this script I did the following:
1)	Remove all records that didn’t explicitly record a count for the species of interest (i.e. remove presence data with no count). 
2)	Remove all old data (data older than 1980 is removed)
3)	Remove all missing location data
4)	Remove all data recorded from sites where the species has never been sighted. This step is to help to get good zero count data from within the actual species range 
5)	Assign each datapoint to a bounding box polygon roughly corresponding to Tak’s expert-elicited network. I had to define the coordinates of this polygon manually;
 to do so I used the Important Bird Areas from Bamford et al to roughly draw polygons around key regions for the species. Not all observations are included in these areas. We might need to re-draw these boundaries but this is a starting point.

We can also pull out some statistics, such as how many uncounted birds aren't picked up by our classification into regions.
We then extract and plot the following data sets:
1) a total count for the region in each week;
2) total number of lists for the region in each week;
3) the average count per list within the region in each week;
I plan to use (3) in my models, which will try to fit the "observed" average count of birds within the region as the basis to estimate the strength of 
connections between regional nodes. The goal is to learn the proportion of birds flying between regions to better inform conservation and cooperation between
flyway countries.
A key assumption is that averaging over all years, all lists, and across all the sites in the region will help to reduce observer bias and detection issues 
(I will include a simple site-based detection probability estimate in my model but these assumptions are absolutely still worth discussing here).

 

